function Base64(){}function CRC32(){}function Chunk(t,e){if(arguments.length>0){if(isNaN(t))throw new Error("Chunk: length must be a number: "+t);if(t<Chunk.EOD)throw new Error("Chunk: length must be >= "+Chunk.EOD);var n=t+4;this.data=new Array(n);for(var s=0;n>s;s++)this.data[s]=0;this.setLength(t-4-4),this.setType(e)}}function IHDRChunk(t,e,n,s,r,h,o){arguments.length>0&&(IHDRChunk.superclass.constructor.call(this,IHDRChunk.EOD,"IHDR"),this.setWidth(t),this.setHeight(e),this.setBitDepth(n),this.setColorType(s),this.setCompression(r),this.setFilter(h),this.setInterlace(o))}function PLTEChunk(t){if(arguments.length>0){if(isNaN(t))throw new Error("PLTEChunk: lastIndex must be a number");if(0>t||t>255)throw new Error("PLTEChunk: lastIndex must be between 0 and 255, inclusive");PLTEChunk.superclass.constructor.call(this,PLTEChunk.DATA+3*(t+1),"PLTE"),this.lastIndex=t}}function IDATChunk(t,e,n){if(arguments.length>0){if(null==n&&(n=1),isNaN(t)||isNaN(e)||isNaN(n))throw new Error("IDATChunk: parameters must be numbers");if(0>t||0>e)throw new Error("IDATChunk: width and height must be positive numbers");if(0>n||n>4)throw new Error("IDATChunk: bytesPerPixel must be between 1 and 4, inclusive");if(this.width=t,this.height=e,this.bytesPerPixel=n,n>1){var s=65530,r=t*n+1,h=Math.floor(s/r);if(e>h){if(lastRowBytes=s-h*r,lastRowBytes<n+1)throw new Error("IDATChunk: this case not yet implemented");lastRowBytes--,s-=lastRowBytes%n}this.blockSize=s+5}else this.blockSize=65535;var o=t*e*n+this.height,i=5*Math.floor((o+this.blockSize-1)/this.blockSize),u=o+i+4;IDATChunk.superclass.constructor.call(this,IDATChunk.DATA+u,"IDAT"),this.initDeflateHeader();for(var a=IDATChunk.DATA,C=0;o>C;C+=this.blockSize){var p=this.blockSize,l=0;C+this.blockSize>=o&&(p=o-C,l=1),this.storeByte(a,l),this.storeInt2Reversed(a+1,p),this.storeInt2Reversed(a+3,~p),a+=this.blockSize+5}}}function IENDChunk(){IENDChunk.superclass.constructor.call(this,Chunk.EOD,"IEND")}function tRNSChunk(t,e){if(arguments.length>0){if(null==e&&(e=1),isNaN(t))throw new Error("tRNSChunk: lastIndex must be a number");if(0>t||t>255)throw new Error("tRNSChunk: lastIndex must be between 0 and 255, inclusive");if(isNaN(e))throw new Error("tRNSChunk: entrySize must be null or a number");if(1!=e&&2!=e&&6!=e)throw new Error("tRNSChunk: entrySize must equal 1, 2 or 6");var n=tRNSChunk.DATA+(t+1)*e;PLTEChunk.superclass.constructor.call(this,n,"tRNS"),this.entrySize=e,this.lastIndex=t}}function Png(){this.chunks=[]}function PngGreyscale(t,e,n){if(arguments.length>0){null==n&&(n=!1),PngGreyscale.superclass.constructor.call(this);var s=n?4:0;this.chunks.push(this.header=new IHDRChunk(t,e,8,s,0,0,0)),this.transparency=null,this.useAlpha=n,this.chunks.push(n?this.image=new IDATChunk(t,e,2):this.image=new IDATChunk(t,e)),this.chunks.push(this.end=new IENDChunk)}}function PngIndex(t,e,n){arguments.length>0&&(PngIndex.superclass.constructor.call(this),this.chunks.push(this.header=new IHDRChunk(t,e,8,3,0,0,0)),this.chunks.push(this.palette=new PLTEChunk(255)),n&&this.chunks.push(this.alphas=new tRNSChunk(255)),this.chunks.push(this.image=new IDATChunk(t,e)),this.chunks.push(this.end=new IENDChunk))}function PngTrueColor(t,e,n){if(arguments.length>0){null==n&&(n=!1),PngTrueColor.superclass.constructor.call(this);var s=n?6:2;this.chunks.push(this.header=new IHDRChunk(t,e,8,s,0,0,0)),this.transparency=null,this.useAlpha=n,this.chunks.push(this.image=new IDATChunk(t,e,n?4:3)),this.chunks.push(this.end=new IENDChunk)}}Base64.encoding=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],Base64.encode=function(t){for(var e,n=[],s=Math.floor(t.length/57),r=t.length%57,h=Math.floor(r/3),o=r%3,i=0,u=0;s>u;u++){for(j=0;j<19;j++,i+=3)e=t[i]<<16|t[i+1]<<8|t[i+2],n.push(Base64.encoding[(16515072&e)>>18]),n.push(Base64.encoding[(258048&e)>>12]),n.push(Base64.encoding[(4032&e)>>6]),n.push(Base64.encoding[63&e]);n.push("\n")}for(u=0;h>u;u++,i+=3)e=t[i]<<16|t[i+1]<<8|t[i+2],n.push(Base64.encoding[(16515072&e)>>18]),n.push(Base64.encoding[(258048&e)>>12]),n.push(Base64.encoding[(4032&e)>>6]),n.push(Base64.encoding[63&e]);return 1==o?(e=t[i]<<16,n.push(Base64.encoding[(16515072&e)>>18]),n.push(Base64.encoding[(258048&e)>>12]),n.push("==")):2==o&&(e=t[i]<<16|t[i+1]<<8,n.push(Base64.encoding[(16515072&e)>>18]),n.push(Base64.encoding[(258048&e)>>12]),n.push(Base64.encoding[(4032&e)>>6]),n.push("=")),n.join("")},CRC32.VERSION=1,CRC32.table=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],CRC32.getCRC=function(t,e,n){for(var s,r=4294967295,h=0;n>h;h++)s=255&(r^t[e+h]),r=r>>8&16777215^CRC32.table[s];return~r},Chunk.VERSION=1,Chunk.LENGTH=0,Chunk.TYPE=Chunk.LENGTH+4,Chunk.EOD=Chunk.TYPE+4,Chunk.prototype.storeByte=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Chunk.storeByte: parameters must be numbers");if(0>t||this.data.length<=t)throw new Error("Chunk.storeByte: offset out of range: "+t);if(0>e||e>255)throw new Error("Chunk.storeByte: value out of range: "+e);this.data[t]=e},Chunk.prototype.storeInt2=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Chunk.storeInt2: parameters must be numbers");if(0>t||this.data.length<=t)throw new Error("Chunk.storeInt2: offset out of range: "+t);if(0>e||e>65535)throw new Error("Chunk.storeInt2: value out of range: "+e);this.data[t++]=e>>8&255,this.data[t]=255&e},Chunk.prototype.storeInt2Reversed=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Chunk.storeInt2Reversed: parameters must be numbers");if(0>t||this.data.length<=t)throw new Error("Chunk.storeInt2Reversed: offset out of range: "+t);this.data[t++]=255&e,this.data[t]=e>>8&255},Chunk.prototype.storeInt4=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Chunk.storeInt4: parameters must be numbers");if(0>t||this.data.length<=t)throw new Error("Chunk.storeInt4: offset out of range: "+t);this.data[t++]=e>>24&255,this.data[t++]=e>>16&255,this.data[t++]=e>>8&255,this.data[t]=255&e},Chunk.prototype.setLength=function(t){this.storeInt4(Chunk.LENGTH,t)},Chunk.prototype.setType=function(t){if("string"!=typeof t)throw new Error("Chunk.setType: parameter must be a string");if(4!=t.length)throw new Error("Chunk.setType: type must be 4 characters in length");for(var e=0;4>e;e++)this.data[Chunk.TYPE+e]=t.charCodeAt(e)},Chunk.prototype.setCRC=function(){var t=this.data.length-8,e=CRC32.getCRC(this.data,4,t);this.storeInt4(this.data.length-4,e)},Chunk.prototype.toString=function(){for(var t=this.data,e=t.length,n=new Array(e),s=0;e>s;s++){var r,h=t[s].toString(),o=t[s].toString(16);r=h>=32&&127>h?String.fromCharCode(t[s]):".",n[s]=h+"		"+o+"		"+r}return n.join("\r\n")},IHDRChunk.VERSION=1,IHDRChunk.WIDTH=Chunk.EOD,IHDRChunk.HEIGHT=IHDRChunk.WIDTH+4,IHDRChunk.BITDEPTH=IHDRChunk.HEIGHT+4,IHDRChunk.COLORTYPE=IHDRChunk.BITDEPTH+1,IHDRChunk.COMPRESSION=IHDRChunk.COLORTYPE+1,IHDRChunk.FILTER=IHDRChunk.COMPRESSION+1,IHDRChunk.INTERLACE=IHDRChunk.FILTER+1,IHDRChunk.EOD=IHDRChunk.INTERLACE+1,IHDRChunk.prototype=new Chunk,IHDRChunk.prototype.constructor=IHDRChunk,IHDRChunk.superclass=Chunk.prototype,IHDRChunk.prototype.setWidth=function(t){this.storeInt4(IHDRChunk.WIDTH,t)},IHDRChunk.prototype.setHeight=function(t){this.storeInt4(IHDRChunk.HEIGHT,t)},IHDRChunk.prototype.setBitDepth=function(t){this.storeByte(IHDRChunk.BITDEPTH,t)},IHDRChunk.prototype.setColorType=function(t){this.storeByte(IHDRChunk.COLORTYPE,t)},IHDRChunk.prototype.setCompression=function(t){this.storeByte(IHDRChunk.COMPRESSION,t)},IHDRChunk.prototype.setFilter=function(t){this.storeByte(IHDRChunk.FILTER,t)},IHDRChunk.prototype.setInterlace=function(t){this.storeByte(IHDRChunk.INTERLACE,t)},PLTEChunk.VERSION=1,PLTEChunk.DATA=Chunk.EOD,PLTEChunk.prototype=new Chunk,PLTEChunk.prototype.constructor=PLTEChunk,PLTEChunk.superclass=Chunk.prototype,PLTEChunk.prototype.setColor=function(t,e,n,s){if(isNaN(t)||isNaN(e)||isNaN(n)||isNaN(s))throw new Error("PLTEChunk.setColor: all parameters must be numbers");if(0>t||this.lastIndex<t)throw new Error("PLTEChunk.setColor: index out of range: "+t);var r=PLTEChunk.DATA+3*t;this.storeByte(r++,e),this.storeByte(r++,n),this.storeByte(r,s)},IDATChunk.VERSION=1,IDATChunk.DEFLATE=Chunk.EOD,IDATChunk.DATA=IDATChunk.DEFLATE+2,IDATChunk.prototype=new Chunk,IDATChunk.prototype.constructor=IDATChunk,IDATChunk.superclass=Chunk.prototype,IDATChunk.prototype.initDeflateHeader=function(){var t=8,e=32768,n=Math.LOG2E*Math.log(e),s=n-8,r=0,h=(s<<4|t)<<8|r<<6;h+=31-h%31,this.setDeflateHeader(h)},IDATChunk.prototype.setChecksum=function(){for(var t=65521,e=5552,n=1,s=0,r=e,h=0;h<this.height;h++){var o=this.getPixelOffset(0,h)-1;n+=this.data[o++],s+=n,0==--r&&(n%=t,s%=t,r=e);for(var i=0;i<this.width;i++)for(var o=this.getPixelOffset(i,h),u=0;u<this.bytesPerPixel;u++)n+=this.data[o++],s+=n,0==--r&&(n%=t,s%=t,r=e)}r!=e&&(n%=t,s%=t),this.storeInt4(this.data.length-8,s<<16|n)},IDATChunk.prototype.setDeflateHeader=function(t){if(isNaN(t))throw new Error("IDATChunk.setDefaultHeader: header must be a number");this.storeInt2(IDATChunk.DEFLATE,t)},IDATChunk.prototype.setPixel=function(t,e,n){if(isNaN(n))throw new Error("IDATChunk.setPixel: parameters must be numbers");if(0>n||n>255)throw new Error("IDATChunk.setPixel: color out of range: "+n);if(arguments.length-2!=this.bytesPerPixel)throw new Error("IDATChunk.setPixel: not enough parameters to specify a color");for(var s=this.getPixelOffset(t,e),r=0;r<this.bytesPerPixel;r++)this.storeByte(s++,arguments[2+r])},IDATChunk.prototype.getPixel=function(t,e){return this.data[this.getPixelOffset(t,e)]},IDATChunk.prototype.getPixelOffset=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("IDATChunk.setPixel: parameters must be numbers");if(0>t||this.width<t)throw new Error("IDATChunk.getPixelOffset: x out of range: "+t);if(0>e||this.width<e)throw new Error("IDATChunk.getPixelOffset: y out of range: "+e);var n=e*this.width*this.bytesPerPixel+e+1+t*this.bytesPerPixel,s=5*Math.floor((n+this.blockSize)/this.blockSize);return IDATChunk.DATA+n+s},IENDChunk.VERSION=1,IENDChunk.prototype=new Chunk,IENDChunk.prototype.constructor=IENDChunk,IENDChunk.superclass=Chunk.prototype,tRNSChunk.VERSION=1,tRNSChunk.DATA=Chunk.EOD,tRNSChunk.prototype=new Chunk,tRNSChunk.prototype.constructor=tRNSChunk,tRNSChunk.superclass=Chunk.prototype,tRNSChunk.prototype.setAlpha=function(t,e){if(isNaN(t))throw new Error("tRNSChunk.setAlpha: index must be a number");if(0>t||this.lastIndex<t)throw new Error("tRNSChunk.setAlpha: index out of range: "+t);if(1!=this.entrySize)throw new Error("tRNSChunk.setAlpha: this function valid with index color images only");this.storeByte(tRNSChunk.DATA+t,e)},tRNSChunk.prototype.setTransparencyValue=function(t){var e=Png.ASV_FIX?1:0;if(2!=this.entrySize||this.lastIndex!=e)throw new Error("tRNSChunk.setTransparencyValue: this function valid with greyscale images only");this.storeInt2(tRNSChunk.DATA,t)},tRNSChunk.prototype.setTransparencyColor=function(t,e,n){if(6!=this.entrySize||0!=this.lastIndex)throw new Error("tRNSChunk.setTransparencyColor: this function valid with color images only");this.storeInt2(tRNSChunk.DATA,t),this.storeInt2(tRNSChunk.DATA+2,e),this.storeInt2(tRNSChunk.DATA+4,n)},Png.VERSION=1,Png.ASV_FIX=!0,Png.prototype.getBase64=function(){return Base64.encode(this.getData())},Png.prototype.setColor=function(t,e,n,s,r){this.palette.setColor(t,e,n,s),null!=r&&null!=this.alphas&&this.alphas.setAlpha(t,r)},Png.prototype.getData=function(){for(var t=this.chunks,e=t.length,n=[],s="PNG\r\n\n",r=0;r<s.length;r++)n.push(s.charCodeAt(r));this.image.setChecksum();for(var r=0;e>r;r++){var h=t[r];h.setCRC(),n=n.concat(h.data)}return n},Png.prototype.getHeight=function(){return this.image.height},Png.prototype.setPixel=function(t,e,n){this.image.setPixel(t,e,n)},Png.prototype.getWidth=function(){return this.image.width},PngGreyscale.VERSION=1,PngGreyscale.prototype=new Png,PngGreyscale.prototype.constructor=PngGreyscale,PngGreyscale.superclass=Png.prototype,PngGreyscale.prototype.setPixel=function(t,e,n,s){this.useAlpha?this.image.setPixel(t,e,n,s):this.image.setPixel(t,e,n)},PngGreyscale.prototype.setTransparencyValue=function(t){if(null==this.transparency){var e=Png.ASV_FIX?1:0;this.transparency=new tRNSChunk(e,2),this.chunks.splice(1,0,this.transparency)}this.transparency.setTransparencyValue(t)},PngIndex.VERSION=1,PngIndex.prototype=new Png,PngIndex.prototype.constructor=PngIndex,PngIndex.superclass=Png.prototype,PngTrueColor.VERSION=1,PngTrueColor.prototype=new Png,PngTrueColor.prototype.constructor=PngTrueColor,PngTrueColor.superclass=Png.prototype,PngTrueColor.prototype.setPixel=function(t,e,n,s,r,h){this.useAlpha?this.image.setPixel(t,e,n,s,r,h):this.image.setPixel(t,e,n,s,r)},PngTrueColor.prototype.setTransparencyColor=function(t,e,n){null==this.transparency&&(this.transparency=new tRNSChunk(0,6),this.chunks.splice(1,0,this.transparency)),this.transparency.setTransparencyColor(t,e,n)};